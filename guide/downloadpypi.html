<!DOCTYPE html>
<html lang="zh">
<!--
  This page was created by cndaqiang with the assistance of Claude (Anthropic AI)
  Created: 2025
-->
<head>
<meta charset="UTF-8">
<title>ä¸‹è½½ autowzry-cli æœ€æ–°ç‰ˆæœ¬</title>
<style>
body {
  font-family: "Segoe UI", sans-serif;
  text-align: center;
  margin-top: 50px;
  background: #f0f2f5;
  padding: 0 20px; /* æ¡Œé¢ç«¯å·¦å³è¾¹è· */
}
h2 {
  color: #333;
  margin-bottom: 30px;
}

/* æŒ‰é’®æ ·å¼ */
.button {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #28a745; /* ä¸‹è½½æŒ‰é’®ç»¿è‰² */
  color: white;
  border: none;
  padding: 14px 24px;
  font-size: 16px;
  border-radius: 10px;
  cursor: pointer;
  margin: 10px auto;
  width: 90%;         /* å“åº”å¼å®½åº¦ */
  max-width: 400px;   /* å¤§å±é™åˆ¶ */
  min-width: 200px;   /* å°å±é™åˆ¶ */
  text-align: left;
  gap: 10px;
  transition: all 0.2s;
  white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
}
.button:hover {
  opacity: 0.9;
}

/* ä¸åŒç”¨é€”çš„æŒ‰é’®é¢œè‰² */
.button-src { background-color: #fd7e14; }   /* æ©™è‰² */
.button-tutorial { background-color: #007bff; } /* è“è‰² */

/* ä¸‹è½½è¿›åº¦æ¡ */
#progressContainer {
  width: 90%;
  max-width: 400px;
  min-width: 200px;
  height: 20px;
  background: #ddd;
  border-radius: 10px;
  margin: 10px auto 20px auto;
  overflow: hidden;
}
#progressBar {
  height: 100%;
  width: 0%;
  background: #0078d7;
  border-radius: 10px;
  transition: width 0.2s;
}
#status {
  font-size: 14px;
  color: #333;
  margin-top: 5px;
}
#releaseTime {
  font-size: 0.85em;
  opacity: 0.9;
  font-weight: normal;
  margin-left: 4px;
}

/* åº•éƒ¨ç‰ˆæƒä¿¡æ¯ */
footer {
  margin-top: 50px;
  padding: 20px;
  font-size: 14px;
  color: #666;
  border-top: 1px solid #e0e0e0;
}

/* å°å±ä¼˜åŒ–å­—ä½“ */
@media (max-width: 400px) {
  .button {
    font-size: 14px;
    padding: 12px 18px;
  }
  #status {
    font-size: 12px;
  }
  #releaseTime {
    display: none; /* å°å±éšè—æ—¥æœŸ */
  }
}
</style>
</head>
<body>
<header>
    <script>
  
  // å¦‚æœæ‚¨ä»‹æ„è¢«ç»Ÿè®¡, è¯·è®¿é—®: blockedDomains
  
  // æ£€æŸ¥ blockedDomains å’Œ allowDomains æ˜¯å¦å®šä¹‰
  const blockedDomains = ["127.0.0.1", "wzry-doc.serv00.net"];
  const allowDomains = ["autowzry.pages.dev", "wzrydoc.readthedocs.io", "cndaqiang.github.io", "wzry-doc.pages.dev"];


  // å°†å½“å‰åŸŸååŠ å…¥åˆ° allowDomains
  if (allowDomains.length === 0) {
    allowDomains.push(window.location.hostname);
  }

  // å®šä¹‰æ£€æŸ¥é»‘åå•å’Œç™½åå•çš„å‡½æ•°
  function isDomainAllowed() {
    return !blockedDomains.includes(window.location.hostname) && allowDomains.includes(window.location.hostname);
  }


  // Google Analytics ç»Ÿè®¡
  
  function loadGoogleAnalytics() {
    const script = document.createElement('script');
    script.async = true;
    script.src = "https://www.googletagmanager.com/gtag/js?id=G-FLH4L3Q02F";
    document.head.appendChild(script);

    // Google Analytics é…ç½®
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-FLH4L3Q02F');
  }
  

  // Baidu Tongji ç»Ÿè®¡
  
  function loadBaiduTongji() {
    var _hmt = _hmt || [];
    (function () {
      const script = document.createElement("script");
      script.src = "//hm.baidu.com/hm.js?76d0fc6b8ffd3901ec51e8bece995b22";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(script, s);
    })();
  }
  

  // Umami ç»Ÿè®¡
  
  function loadUmami() {
    const script = document.createElement('script');
    script.defer = true;
    script.src = '//cloud.umami.is/script.js';
    script.setAttribute('data-website-id', '1d2518ba-011c-47f7-bf3d-c2454778ef02');
    document.head.appendChild(script);
  }
  

  // å¦‚æœå½“å‰åŸŸåå…è®¸åŠ è½½ç»Ÿè®¡è„šæœ¬ï¼ŒæŒ‰éœ€è°ƒç”¨å„ä¸ªç»Ÿè®¡å‡½æ•°
  if (isDomainAllowed()) {
     loadGoogleAnalytics(); 
     loadBaiduTongji(); 
     loadUmami(); 
  }
</script>
</header>

<h2>ä¸‹è½½ autowzry-cli æœ€æ–°ç‰ˆæœ¬</h2>

<!-- Windows ä¸‹è½½ -->
<button id="downloadWin" class="button">ğŸ–¥ï¸ ä¸‹è½½å¯æ‰§è¡ŒåŒ… Windows <span id="releaseTime"></span></button>
<div id="progressContainer"><div id="progressBar"></div></div>
<div id="status">æ­£åœ¨è·å–ç‰ˆæœ¬ä¿¡æ¯...</div>

<!-- Linux/macOS æºç  -->
<button id="downloadSrc" class="button button-src">ğŸ§ ä¸‹è½½æºç  Linux/macOS  </button>

<!-- æ•™ç¨‹æŒ‰é’® -->
<button id="tutorial1" class="button button-tutorial">ğŸ“˜ Windowsç³»ç»Ÿæ•™ç¨‹</button>
<button id="tutorial2" class="button button-tutorial">ğŸ“— æºä»£ç è¿è¡Œæ•™ç¨‹</button>

<script>
/*
 * é‡è¦è¯´æ˜ï¼šé•œåƒç«™ä¸‹è½½æ–¹æ¡ˆä¸å¯è¡Œ
 *
 * åŸå› ï¼š
 * 1. é•œåƒç«™çš„ JSON API æœ‰ CORSï¼ˆè·¨åŸŸï¼‰é™åˆ¶ï¼Œæµè§ˆå™¨ JavaScript æ— æ³•è®¿é—®
 * 2. é•œåƒç«™çš„ Simple Index è™½ç„¶å¯ä»¥è§£æï¼Œä½†ä¸‹è½½æ–‡ä»¶æ—¶åŒæ ·å— CORS é™åˆ¶
 * 3. ä½¿ç”¨ <a> æ ‡ç­¾ç›´æ¥ä¸‹è½½å¯ä»¥ç»•è¿‡ CORSï¼Œä½†æ— æ³•è·å–ä¸‹è½½è¿›åº¦
 * 4. é•œåƒç«™ä¸»è¦æœåŠ¡äº pip å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸æ˜¯ä¸ºæµè§ˆå™¨ç¯å¢ƒè®¾è®¡çš„
 *
 * ç»“è®ºï¼šåªèƒ½ä» PyPI å®˜æ–¹è·å–ç‰ˆæœ¬ä¿¡æ¯å’Œä¸‹è½½æ–‡ä»¶
 * ä»¥åä¸è¦å†å°è¯•å¼€å‘é•œåƒç«™è‡ªåŠ¨ä¸‹è½½åŠŸèƒ½
 */

// âœ… ç¼“å­˜ PyPI æ•°æ®ï¼Œé¿å…é‡å¤è¯·æ±‚
let cachedData = null;

// âœ… ä» PyPI è·å–æ•°æ®
async function fetchFromSource(url, timeout = 5000) {
  const controller = new AbortController();
  const timer = setTimeout(() => controller.abort(), timeout);

  try {
    const resp = await fetch(url, {
      cache: 'no-store',
      signal: controller.signal
    });
    clearTimeout(timer);
    return await resp.json();
  } catch (err) {
    clearTimeout(timer);
    throw err;
  }
}

// âœ… è·å–å¹¶æ˜¾ç¤ºç‰ˆæœ¬å‘å¸ƒæ—¶é—´
async function fetchVersionInfo() {
  try {
    document.getElementById('status').textContent = 'æ­£åœ¨è·å–ç‰ˆæœ¬ä¿¡æ¯...';
    const data = await fetchFromSource(`https://pypi.org/pypi/autowzry-cli/json?ts=${Date.now()}`);
    cachedData = data;
    console.log('âœ“ æˆåŠŸä» PyPI è·å–æ•°æ®');

    // æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
    const version = cachedData.info.version;
    console.log('ç‰ˆæœ¬å·:', version);

    const file = cachedData.urls.find(f => f.url.includes('win_amd64') && f.url.endsWith('.whl'));
    console.log('æ‰¾åˆ°çš„æ–‡ä»¶:', file ? file.filename : 'æœªæ‰¾åˆ°');

    if (file && file.upload_time_iso_8601) {
      const uploadDate = new Date(file.upload_time_iso_8601);
      const formattedDate = uploadDate.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
      }).replace(/\//g, '/');
      document.getElementById('releaseTime').textContent = `(${formattedDate})`;
    } else {
      document.getElementById('releaseTime').textContent = '';
    }

    document.getElementById('status').textContent = 'å‡†å¤‡ä¸‹è½½...';
  } catch (err) {
    console.error('è·å–ç‰ˆæœ¬ä¿¡æ¯å¤±è´¥:', err);
    document.getElementById('status').textContent = 'âš ï¸ æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯·åˆ‡æ¢ç½‘ç»œç¯å¢ƒ';
    document.getElementById('releaseTime').textContent = '';
    cachedData = null;
  }
}

// âœ… ä¸‹è½½å¸¦è¿›åº¦æ¡
async function downloadWithProgress(url, filename) {
  const status = document.getElementById('status');
  const progressBar = document.getElementById('progressBar');
  status.textContent = 'å¼€å§‹ä¸‹è½½...';
  progressBar.style.width = '0%';

  const resp = await fetch(url);
  if (!resp.ok) throw new Error('ä¸‹è½½å¤±è´¥');

  const contentLength = resp.headers.get('Content-Length');
  const total = contentLength ? parseInt(contentLength, 10) : 0;

  const reader = resp.body.getReader();
  const chunks = [];
  let received = 0;

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    chunks.push(value);
    received += value.length;
    if (total) {
      const percent = ((received / total) * 100).toFixed(1);
      status.textContent = `ä¸‹è½½ä¸­ï¼š${percent}%`;
      progressBar.style.width = `${percent}%`;
    } else {
      status.textContent = `ä¸‹è½½ä¸­ï¼š${(received / 1024).toFixed(1)} KB`;
    }
  }

  const blob = new Blob(chunks);
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);

  status.textContent = 'ä¸‹è½½å®Œæˆï¼';
  progressBar.style.width = '100%';
}

// âœ… Windows ä¸‹è½½æŒ‰é’®
async function downloadWinLatest() {
  // æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜æ•°æ®
  if (!cachedData) {
    alert('æ— æ³•è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œè¯·ç¡®ä¿ç½‘ç»œå¯ä»¥è®¿é—® PyPI (pypi.org)');
    return;
  }

  try {
    // æ‰¾ Windows amd64 wheel
    const file = cachedData.urls.find(f => f.url.includes('win_amd64') && f.url.endsWith('.whl'));
    if (!file) {
      alert('æœªæ‰¾åˆ° Windows wheel æ–‡ä»¶');
      return;
    }

    const version = cachedData.info.version;
    const filename = `autowzry-cli-${version}.zip`;
    const downloadUrl = file.url;

    console.log('å¼€å§‹ä¸‹è½½:', downloadUrl);
    await downloadWithProgress(downloadUrl, filename);
  } catch (err) {
    console.error('ä¸‹è½½å¤±è´¥:', err);
    alert('ä¸‹è½½å‡ºé”™ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
  }
}

// âœ… Linux/macOS æºç ä¸‹è½½ï¼ˆå›ºå®š URLï¼‰
function downloadSrc() {
  window.open("https://github.com/cndaqiang/autowzry/tree/dev", "_blank");
}

// âœ… æ•™ç¨‹è·³è½¬
function openTutorial1() {
  window.open("https://cndaqiang.github.io/wzry.doc/guide/install/", "_blank");
}
function openTutorial2() {
  window.open("https://cndaqiang.github.io/wzry.doc/guide/pyinstall/", "_blank");
}

// ç»‘å®šæŒ‰é’®
document.getElementById('downloadWin').addEventListener('click', downloadWinLatest);
document.getElementById('downloadSrc').addEventListener('click', downloadSrc);
document.getElementById('tutorial1').addEventListener('click', openTutorial1);
document.getElementById('tutorial2').addEventListener('click', openTutorial2);

// é¡µé¢åŠ è½½æ—¶è·å–ç‰ˆæœ¬ä¿¡æ¯
fetchVersionInfo();
</script>

<footer>
  <p>Copyright Â© 2025 AUTOWZRY</p>
</footer>

</body>
</html>
